-- Pet Simulator X Autofarm Script
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local ScrollFrame = Instance.new("ScrollingFrame")
local UIListLayout = Instance.new("UIListLayout")
local CloseButton = Instance.new("TextButton")

-- Autofarm Status
local farmingActive = false
local farmingChests = false
local farmingCoins = false

-- Services
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- GUI Setup
ScreenGui.Parent = game.CoreGui
ScreenGui.Name = "PSXAutofarm"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

-- Main Frame
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MainFrame.BackgroundTransparency = 0.1
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.3, 0, 0.3, 0)
MainFrame.Size = UDim2.new(0, 400, 0, 300)
MainFrame.Active = true
MainFrame.Draggable = true

-- Title
Title.Parent = MainFrame
Title.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
Title.BackgroundTransparency = 0.1
Title.BorderSizePixel = 0
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Font = Enum.Font.GothamBold
Title.Text = "Pet Simulator X - Autofarm"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18

-- Close Button (X)
CloseButton.Parent = MainFrame
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 18

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
    farmingActive = false
    farmingChests = false
    farmingCoins = false
end)

-- Scroll Frame
ScrollFrame.Parent = MainFrame
ScrollFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
ScrollFrame.BackgroundTransparency = 0.3
ScrollFrame.BorderSizePixel = 0
ScrollFrame.Position = UDim2.new(0, 10, 0, 50)
ScrollFrame.Size = UDim2.new(1, -20, 1, -60)
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
ScrollFrame.ScrollBarThickness = 6

-- UI List Layout
UIListLayout.Parent = ScrollFrame
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Padding = UDim.new(0, 5)

-- Function to find coins in workspace
local function findCoins()
    local coins = {}
    for _, v in pairs(workspace:GetDescendants()) do
        if v.Name == "Coin" or v.Name == "Coins" or (v:IsA("Model") and v:FindFirstChild("Coin")) then
            if v:FindFirstChild("HumanoidRootPart") or v:IsA("BasePart") then
                table.insert(coins, v)
            end
        end
    end
    return coins
end

-- Function to find chests in workspace
local function findChests()
    local chests = {}
    for _, v in pairs(workspace:GetDescendants()) do
        if v.Name:lower():find("chest") and (v:IsA("Model") or v:IsA("BasePart")) then
            table.insert(chests, v)
        end
    end
    return chests
end

-- Function to teleport to target
local function teleportTo(target)
    if not target then return end
    
    local targetPos
    if target:IsA("Model") then
        targetPos = target:FindFirstChild("HumanoidRootPart") or target:FindFirstChildWhichIsA("BasePart")
    else
        targetPos = target
    end
    
    if targetPos and Character and HumanoidRootPart then
        HumanoidRootPart.CFrame = targetPos.CFrame + Vector3.new(0, 5, 0)
    end
end

-- Function to activate pets on target
local function activatePetsOnTarget(target)
    -- Simuliert das Klicken auf das Target mit Pets
    if target then
        -- Versuche ClickDetector zu finden und zu aktivieren
        local clickDetector = target:FindFirstChildOfClass("ClickDetector", true)
        if clickDetector then
            fireclickdetector(clickDetector)
        end
        
        -- Suche auch in Child-Objekten
        for _, child in pairs(target:GetDescendants()) do
            if child:IsA("ClickDetector") then
                fireclickdetector(child)
            end
        end
        
        -- Versuche ProximityPrompt zu aktivieren
        local proximityPrompt = target:FindFirstChildOfClass("ProximityPrompt", true)
        if proximityPrompt then
            fireproximityprompt(proximityPrompt)
        end
    end
end

-- Function to make pets attack target
local function makePetsAttack(target)
    if not target then return end
    
    -- Suche nach Pets im Workspace
    local pets = {}
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("Model") and v.Name:find("Pet") and v:FindFirstChild(Player.Name) then
            table.insert(pets, v)
        end
    end
    
    -- Aktiviere Pets auf das Target
    for _, pet in pairs(pets) do
        spawn(function()
            local petRoot = pet:FindFirstChild("HumanoidRootPart") or pet:FindFirstChildWhichIsA("BasePart")
            if petRoot then
                -- Teleportiere Pet zum Target
                petRoot.CFrame = target.CFrame
            end
        end)
    end
    
    -- Remote Events für Pet-Attacken
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    for _, v in pairs(ReplicatedStorage:GetDescendants()) do
        if v:IsA("RemoteEvent") or v:IsA("RemoteFunction") then
            if v.Name:lower():find("pet") or v.Name:lower():find("attack") or v.Name:lower():find("damage") then
                pcall(function()
                    v:FireServer(target)
                    v:FireServer({Target = target})
                    v:FireServer("Attack", target)
                end)
            end
        end
    end
end

-- Function to auto-click while near target
local function autoClickNearTarget(target, duration)
    local startTime = tick()
    while tick() - startTime < duration do
        if not farmingActive and not farmingChests and not farmingCoins then break end
        
        -- Kontinuierliches Klicken
        activatePetsOnTarget(target)
        
        -- Pets sollen DPS machen
        makePetsAttack(target)
        
        -- Simuliere Mausklicks
        local mouse = Player:GetMouse()
        if mouse then
            mouse1click()
        end
        
        wait(0.1)
    end
end

-- Main Farm Function
local function startMainFarm(active)
    farmingActive = active
    spawn(function()
        while farmingActive do
            local coins = findCoins()
            
            if #coins > 0 then
                for _, coin in pairs(coins) do
                    if not farmingActive then break end
                    
                    -- Teleport zum Coin
                    teleportTo(coin)
                    wait(0.3)
                    
                    -- Auto-Click für 3 Sekunden während wir auf dem Coin stehen
                    autoClickNearTarget(coin, 3)
                end
            else
                print("Keine Coins gefunden, warte...")
                wait(3)
            end
            
            wait(0.5)
        end
    end)
end

-- Farm Chests Function
local function farmChestsFunc(active)
    farmingChests = active
    spawn(function()
        while farmingChests do
            local chests = findChests()
            
            if #chests > 0 then
                for _, chest in pairs(chests) do
                    if not farmingChests then break end
                    
                    teleportTo(chest)
                    wait(0.3)
                    
                    -- Auto-Click für 4 Sekunden auf Chest
                    autoClickNearTarget(chest, 4)
                end
            else
                print("Keine Chests gefunden, warte...")
                wait(3)
            end
            
            wait(0.5)
        end
    end)
end

-- Farm Coins Function
local function farmCoinsFunc(active)
    farmingCoins = active
    spawn(function()
        while farmingCoins do
            local coins = findCoins()
            
            if #coins > 0 then
                for _, coin in pairs(coins) do
                    if not farmingCoins then break end
                    
                    teleportTo(coin)
                    wait(0.3)
                    
                    -- Auto-Click für 2 Sekunden auf Coin
                    autoClickNearTarget(coin, 2)
                end
            else
                print("Keine Coins gefunden, warte...")
                wait(3)
            end
            
            wait(0.3)
        end
    end)
end

-- Function to create farm option
local function createFarmOption(name, callback)
    local OptionFrame = Instance.new("Frame")
    local OptionLabel = Instance.new("TextLabel")
    local ToggleButton = Instance.new("TextButton")
    
    OptionFrame.Parent = ScrollFrame
    OptionFrame.BackgroundColor3 = Color3.fromRGB(55, 55, 65)
    OptionFrame.BorderSizePixel = 0
    OptionFrame.Size = UDim2.new(1, -10, 0, 50)
    
    OptionLabel.Parent = OptionFrame
    OptionLabel.BackgroundTransparency = 1
    OptionLabel.Position = UDim2.new(0, 10, 0, 0)
    OptionLabel.Size = UDim2.new(0.5, -10, 1, 0)
    OptionLabel.Font = Enum.Font.Gotham
    OptionLabel.Text = name
    OptionLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    OptionLabel.TextSize = 16
    OptionLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    ToggleButton.Parent = OptionFrame
    ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    ToggleButton.BorderSizePixel = 0
    ToggleButton.Position = UDim2.new(0.6, 0, 0.2, 0)
    ToggleButton.Size = UDim2.new(0.35, 0, 0.6, 0)
    ToggleButton.Font = Enum.Font.GothamBold
    ToggleButton.Text = "OFF"
    ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleButton.TextSize = 14
    
    local isActive = false
    
    ToggleButton.MouseButton1Click:Connect(function()
        isActive = not isActive
        if isActive then
            ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
            ToggleButton.Text = "ON"
        else
            ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
            ToggleButton.Text = "OFF"
        end
        callback(isActive)
    end)
    
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y + 10)
end

-- Create Farm Options
createFarmOption("Farm", startMainFarm)
createFarmOption("Chest", farmChestsFunc)
createFarmOption("Coins", farmCoinsFunc)

-- Update character reference when respawning
Player.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
end)

print("Pet Simulator X Autofarm loaded!")
